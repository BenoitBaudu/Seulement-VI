<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>VI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ===================================== -->
<!-- Open Graph / Facebook -->
<!-- ===================================== -->
<meta property="og:type" content="website">
<meta property="og:title" content="VI">
<meta property="og:image" content="https://github.com/BenoitBaudu/Seulement-VI/blob/main/og-vi.png">
<meta property="og:url" content="https://benoitbaudu.github.io/Seulement-VI/">
<meta property="og:site_name" content="Benoît Baudu">

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #fff;
  overflow: hidden;
  height: 100%;
}

canvas { display: block; }

/* symbole */
#symbol {
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 22vmin;
  opacity: 0;
  pointer-events: none;
  mix-blend-mode: screen;
  z-index: 5;
}

/* lien album */
#album-link {
  position: fixed;
  top: calc(50% + 14vmin);
  left: 50%;
  transform: translateX(-50%);
  font-family: sans-serif;
  font-size: 12px;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: rgba(255,255,255,0.9);
  text-decoration: none;
  transition: opacity 0.4s ease;
  z-index: 6;
}
#album-link:hover { opacity: 1; }

/* texte activation son */
#sound-hint {
  position: fixed;
  top: calc(50% - 18vmin);
  left: 50%;
  transform: translateX(-50%);
  font-family: sans-serif;
  font-size: 12px;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: rgba(120,120,120,0.8);
  cursor: pointer;
  transition: opacity 0.8s ease;
  z-index: 10;
}
#sound-hint.hidden {
  opacity: 0;
  pointer-events: none;
}
</style>
</head>

<body>

<canvas id="gl"></canvas>

<img id="symbol" src="VI@4x.png" alt="">

<a id="album-link"
   href="https://linktr.ee/benoitbaudu"
   target="_blank">
  Écouter l’album
</a>

<div id="sound-hint">cliquez pour activer le son</div>
<audio id="audio" src="6.VI.mp3" preload="auto"></audio>

<script>
// ====================================================
// TIMELINE COULEURS
// ====================================================
const TIMELINE = [
  { start: 0,   end: 31,  from: "white",  to: "pink"   },
  { start: 31,  end: 64,  from: "pink",   to: "yellow" },
  { start: 64,  end: 79,  from: "yellow", to: "yellow" },
  { start: 79,  end: 112, from: "yellow", to: "green"  },
  { start: 112, end: 130, from: "green",  to: "green"  },
  { start: 130, end: 162, from: "green",  to: "blue"   },
  { start: 162, end: 184, from: "blue",   to: "white"  }
];

const COLORS = {
  white:  [1.0, 1.0, 1.0],
  pink:   [0.98, 0.72, 0.82],
  yellow: [0.95, 0.90, 0.70],
  green:  [0.70, 0.88, 0.80],
  blue:   [0.55, 0.75, 0.85]
};

// ====================================================
// WEBGL
// ====================================================
const canvas = document.getElementById("gl");
const gl = canvas.getContext("webgl");

function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
  gl.viewport(0, 0, canvas.width, canvas.height);
}
window.addEventListener("resize", resize);
resize();

// ====================================================
// SHADERS
// ====================================================
const vert = `
attribute vec2 position;
void main() {
  gl_Position = vec4(position, 0.0, 1.0);
}
`;

const frag = `
precision highp float;

uniform vec2 resolution;
uniform float time;
uniform vec3 colorA;
uniform vec3 colorB;
uniform float mixAB;

float noise(vec2 p){
  return fract(sin(dot(p, vec2(12.9898,78.233))) * 43758.5453);
}

float fbm(vec2 p){
  float v = 0.0;
  float a = 0.5;
  for(int i=0;i<4;i++){
    v += a * noise(p);
    p *= 2.0;
    a *= 0.5;
  }
  return v;
}

void main(){
  vec2 uv = gl_FragCoord.xy / resolution.xy;
  uv.y = 1.0 - uv.y;

  float t = time * 0.08;

  vec2 p = uv * 4.0
         + vec2(
             sin(t + uv.y * 2.0),
             cos(t * 0.9 + uv.x * 2.0)
           );

  float n = fbm(p);

  float waves =
    sin(p.x * 3.5 + time * 1.4) +
    sin(p.y * 3.0 - time * 1.2);

  waves *= 0.04;

  vec3 base = mix(colorA, colorB, mixAB);
  base += (n * 0.05) + waves;

  gl_FragColor = vec4(base, 1.0);
}
`;

// ====================================================
// PROGRAMME
// ====================================================
function compile(type, src){
  const s = gl.createShader(type);
  gl.shaderSource(s, src);
  gl.compileShader(s);
  return s;
}

const program = gl.createProgram();
gl.attachShader(program, compile(gl.VERTEX_SHADER, vert));
gl.attachShader(program, compile(gl.FRAGMENT_SHADER, frag));
gl.linkProgram(program);
gl.useProgram(program);

const buffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
  -1,-1, 1,-1, -1,1,
  -1,1, 1,-1, 1,1
]), gl.STATIC_DRAW);

const pos = gl.getAttribLocation(program, "position");
gl.enableVertexAttribArray(pos);
gl.vertexAttribPointer(pos, 2, gl.FLOAT, false, 0, 0);

const uTime = gl.getUniformLocation(program, "time");
const uRes  = gl.getUniformLocation(program, "resolution");
const uColA = gl.getUniformLocation(program, "colorA");
const uColB = gl.getUniformLocation(program, "colorB");
const uMix  = gl.getUniformLocation(program, "mixAB");

// ====================================================
// UTILITAIRES
// ====================================================
const symbol = document.getElementById("symbol");

function smoothstep(x){
  return x * x * (3.0 - 2.0 * x);
}

function getState(t){
  for(let s of TIMELINE){
    if(t >= s.start && t <= s.end){
      let local = (t - s.start) / (s.end - s.start);
      let k = smoothstep(local);
      return {
        a: COLORS[s.from],
        b: COLORS[s.to],
        mix: k,
        symbol: (k * (1.0 - k)) * 4.0
      };
    }
  }
  return { a: COLORS.white, b: COLORS.white, mix: 0, symbol: 0 };
}

// ====================================================
// RENDER
// ====================================================
let start = null;

function draw(ts){
  if(!start) start = ts;
  const t = (ts - start) / 1000;

  const s = getState(t);
  symbol.style.opacity = Math.min(s.symbol, 0.9);

  gl.uniform1f(uTime, t);
  gl.uniform3fv(uColA, s.a);
  gl.uniform3fv(uColB, s.b);
  gl.uniform1f(uMix, s.mix);
  gl.uniform2f(uRes, canvas.width, canvas.height);

  gl.drawArrays(gl.TRIANGLES, 0, 6);
  requestAnimationFrame(draw);
}

requestAnimationFrame(draw);

// ====================================================
// AUDIO
// ====================================================
const hint = document.getElementById("sound-hint");
let audio, ctx, src;

function startAudio(){
  audio = document.getElementById("audio");
  ctx = new AudioContext();
  src = ctx.createMediaElementSource(audio);
  src.connect(ctx.destination);
  audio.play();
  hint.classList.add("hidden");
}

hint.addEventListener("click", startAudio, { once:true });
document.body.addEventListener("click", startAudio, { once:true });
</script>

</body>
</html>
